<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>TPUSA Intel - Content Aggregator</title>
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
  -webkit-tap-highlight-color: transparent;
}

/* Ocean Calm Palette (Professional/Finance/Intel) */
:root {
  /* Colors */
  --primary: #0A84FF;
  --primary-light: #5AC8FA;
  --secondary: #30D158;
  --accent: #FF9F0A;
  --surface: #FFFFFF;
  --surface-secondary: #F2F2F7;
  --surface-tertiary: #E5E5EA;
  --text-primary: #1C1C1E;
  --text-secondary: #3C3C43;
  --text-tertiary: #8E8E93;
  --border: #D1D1D6;
  --error: #FF3B30;
  --warning: #FF9500;
  --success: #34C759;
  
  /* Spacing (4px grid) */
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-5: 1.25rem;
  --space-6: 1.5rem;
  --space-8: 2rem;
  
  /* Touch Targets */
  --touch-min: 44px;
  
  /* Radius */
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.25rem;
  --radius-full: 9999px;
  
  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
  --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.16);
  --shadow-primary: 0 4px 14px rgba(10, 132, 255, 0.25);
  
  /* Safe areas */
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
}

[data-theme="dark"] {
  --primary: #0A84FF;
  --surface: #1C1C1E;
  --surface-secondary: #2C2C2E;
  --surface-tertiary: #3A3A3C;
  --text-primary: #FFFFFF;
  --text-secondary: rgba(235, 235, 245, 0.6);
  --border: #38383A;
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
  --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", system-ui, sans-serif;
  background: var(--surface-secondary);
  color: var(--text-primary);
  min-height: 100vh;
  padding-bottom: calc(72px + var(--safe-bottom));
  overflow-x: hidden;
}

/* Header */
.app-header {
  position: sticky;
  top: var(--safe-top);
  z-index: 100;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 0.5px solid rgba(0, 0, 0, 0.1);
  padding: var(--space-4) var(--space-5);
}

[data-theme="dark"] .app-header {
  background: rgba(28, 28, 30, 0.85);
  border-bottom-color: rgba(255, 255, 255, 0.1);
}

.header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 1200px;
  margin: 0 auto;
}

.logo {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-primary);
}

.logo-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--error) 0%, var(--warning) 100%);
  border-radius: var(--radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.125rem;
}

/* Theme Toggle - 44px Touch Target */
.theme-toggle {
  width: var(--touch-min);
  height: var(--touch-min);
  border-radius: var(--radius-full);
  background: var(--surface);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 1.125rem;
}

.theme-toggle:active {
  transform: scale(0.95);
  background: var(--surface-secondary);
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--space-6) var(--space-4);
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-3);
  margin-bottom: var(--space-6);
}

@media (min-width: 640px) {
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

.stat-card {
  background: var(--surface);
  border-radius: var(--radius-xl);
  padding: var(--space-4);
  box-shadow: var(--shadow-sm);
  transition: all 0.2s;
}

.stat-card:active {
  transform: scale(0.98);
}

.stat-label {
  font-size: 0.6875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-tertiary);
  margin-bottom: var(--space-2);
  font-weight: 600;
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--text-primary);
  line-height: 1.2;
}

.stat-value.primary {
  color: var(--primary);
}

.stat-value.success {
  color: var(--success);
}

.stat-value.warning {
  color: var(--warning);
}

/* Filters */
.filters-section {
  display: flex;
  gap: var(--space-3);
  margin-bottom: var(--space-6);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: var(--space-2);
}

.filters-section::-webkit-scrollbar {
  display: none;
}

.filter-chip {
  height: 40px;
  padding: 0 var(--space-4);
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-full);
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}

.filter-chip:active {
  transform: scale(0.96);
}

.filter-chip.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
}

/* Content Cards */
.content-section {
  margin-bottom: var(--space-8);
}

.section-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-4);
}

.content-grid {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.content-card {
  background: var(--surface);
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: all 0.2s;
}

.content-card:active {
  transform: scale(0.99);
  box-shadow: var(--shadow-md);
}

.content-media {
  position: relative;
  width: 100%;
  padding-top: 56.25%; /* 16:9 aspect ratio */
  background: var(--surface-secondary);
  overflow: hidden;
}

.content-media img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.platform-badge {
  position: absolute;
  top: var(--space-3);
  left: var(--space-3);
  padding: var(--space-1) var(--space-3);
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 600;
  color: white;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.content-body {
  padding: var(--space-4);
}

.content-meta {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  margin-bottom: var(--space-3);
}

.target-badge {
  display: inline-flex;
  align-items: center;
  padding: var(--space-1) var(--space-2);
  background: var(--surface-secondary);
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--error);
}

.content-text {
  font-size: 0.9375rem;
  line-height: 1.5;
  color: var(--text-primary);
  margin-bottom: var(--space-3);
}

.content-stats {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding-top: var(--space-3);
  border-top: 1px solid var(--border);
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.stat-item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

/* Bottom Navigation */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-top: 0.5px solid rgba(0, 0, 0, 0.1);
  padding-bottom: var(--safe-bottom);
  box-shadow: var(--shadow-lg);
}

[data-theme="dark"] .bottom-nav {
  background: rgba(28, 28, 30, 0.85);
  border-top-color: rgba(255, 255, 255, 0.1);
}

.nav-container {
  display: flex;
  align-items: center;
  justify-content: space-around;
  max-width: 600px;
  margin: 0 auto;
  padding: var(--space-2) var(--space-4);
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-2);
  min-width: var(--touch-min);
  min-height: var(--touch-min);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all 0.2s;
  color: var(--text-tertiary);
  text-decoration: none;
}

.nav-item:active {
  transform: scale(0.95);
  background: var(--surface-secondary);
}

.nav-item.active {
  color: var(--primary);
}

.nav-icon {
  font-size: 1.5rem;
  line-height: 1;
}

.nav-label {
  font-size: 0.6875rem;
  font-weight: 600;
  text-align: center;
}

/* Loading & Empty States */
.loading, .empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-4);
  text-align: center;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: var(--space-4);
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: var(--space-4);
  opacity: 0.3;
}

.empty-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: var(--space-2);
}

.empty-text {
  font-size: 0.9375rem;
  color: var(--text-tertiary);
}

/* Utility */
.hidden { display: none; }
</style>
</head>
<body data-theme="light">

<!-- Header -->
<header class="app-header">
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon">üîç</div>
      <span>TPUSA Intel</span>
    </div>
    <button class="theme-toggle" id="themeToggle">
      <span id="themeIcon">üåô</span>
    </button>
  </div>
</header>

<!-- Main Container -->
<main class="container">
  <!-- Stats Grid -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card">
      <div class="stat-label">Content</div>
      <div class="stat-value primary" id="contentCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Targets</div>
      <div class="stat-value success" id="targetCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Engagement</div>
      <div class="stat-value warning" id="engagementCount">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Latest</div>
      <div class="stat-value" id="latestTime">-</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <button class="filter-chip active" data-platform="all" onclick="filterPlatform('all')">All</button>
    <button class="filter-chip" data-platform="tiktok" onclick="filterPlatform('tiktok')">TikTok</button>
    <button class="filter-chip" data-platform="x" onclick="filterPlatform('x')">X</button>
    <button class="filter-chip" data-target="all" onclick="filterTarget('all')">All Targets</button>
  </div>

  <!-- Content Section -->
  <section class="content-section">
    <h2 class="section-title">Latest Content</h2>
    <div id="contentContainer">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading content...</p>
      </div>
    </div>
  </section>
</main>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <div class="nav-container">
    <a href="#" class="nav-item active">
      <div class="nav-icon">üìä</div>
      <div class="nav-label">Feed</div>
    </a>
    <a href="#" class="nav-item" onclick="showComingSoon(event)">
      <div class="nav-icon">üéØ</div>
      <div class="nav-label">Targets</div>
    </a>
    <a href="#" class="nav-item" onclick="scanContent(event)">
      <div class="nav-icon">üîç</div>
      <div class="nav-label">Scan</div>
    </a>
    <a href="#" class="nav-item" onclick="showComingSoon(event)">
      <div class="nav-icon">‚öôÔ∏è</div>
      <div class="nav-label">Settings</div>
    </a>
  </div>
</nav>

<script>
// Theme Toggle
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const body = document.body;

let currentTheme = localStorage.getItem('theme') || 'light';
body.setAttribute('data-theme', currentTheme);
themeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

themeToggle.addEventListener('click', () => {
  currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
  body.setAttribute('data-theme', currentTheme);
  themeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', currentTheme);
});

// API Configuration
const API_BASE = '/.netlify/functions';

let allContent = [];
let currentPlatform = 'all';
let currentTarget = 'all';

// Fetch Content
async function fetchContent() {
  try {
    const response = await fetch(`${API_BASE}/content`);
    if (!response.ok) throw new Error('Failed to fetch content');
    const data = await response.json();
    return data.content || [];
  } catch (error) {
    console.error('Error fetching content:', error);
    return [];
  }
}

// Fetch Stats
async function fetchStats() {
  try {
    const response = await fetch(`${API_BASE}/stats`);
    if (!response.ok) throw new Error('Failed to fetch stats');
    return await response.json();
  } catch (error) {
    console.error('Error fetching stats:', error);
    return {};
  }
}

// Render Content
function renderContent(content) {
  const container = document.getElementById('contentContainer');
  
  // Filter content
  const filtered = content.filter(item => {
    const platformMatch = currentPlatform === 'all' || item.platform === currentPlatform;
    const targetMatch = currentTarget === 'all' || item.target === currentTarget;
    return platformMatch && targetMatch;
  });
  
  if (filtered.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üì≠</div>
        <div class="empty-title">No Content Found</div>
        <div class="empty-text">Try adjusting your filters or scan for new content</div>
      </div>
    `;
    return;
  }

  container.innerHTML = `
    <div class="content-grid">
      ${filtered.map(item => `
        <div class="content-card">
          <div class="content-media">
            <img src="${item.thumbnail || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'225\'%3E%3Crect fill=\'%23f3f4f6\' width=\'400\' height=\'225\'/%3E%3C/svg%3E'}" alt="${item.title || 'Content'}">
            <div class="platform-badge">${item.platform}</div>
          </div>
          <div class="content-body">
            <div class="content-meta">
              <div class="target-badge">üéØ ${item.target}</div>
              <span style="font-size: 0.75rem; color: var(--text-tertiary);">${formatTime(item.timestamp)}</span>
            </div>
            <div class="content-text">${item.text || item.title || 'No description available'}</div>
            <div class="content-stats">
              <div class="stat-item">
                <span>‚ù§Ô∏è</span>
                <span>${formatNumber(item.likes || 0)}</span>
              </div>
              <div class="stat-item">
                <span>üí¨</span>
                <span>${formatNumber(item.comments || 0)}</span>
              </div>
              <div class="stat-item">
                <span>üîÑ</span>
                <span>${formatNumber(item.shares || 0)}</span>
              </div>
              <div class="stat-item">
                <span>üëÅÔ∏è</span>
                <span>${formatNumber(item.views || 0)}</span>
              </div>
            </div>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

// Update Stats
function updateStats(stats) {
  document.getElementById('contentCount').textContent = stats.totalContent || 0;
  document.getElementById('targetCount').textContent = stats.totalTargets || 0;
  document.getElementById('engagementCount').textContent = formatNumber(stats.totalEngagement || 0);
  document.getElementById('latestTime').textContent = stats.lastScan ? formatTime(stats.lastScan) : 'Never';
}

// Filter Functions
function filterPlatform(platform) {
  currentPlatform = platform;
  document.querySelectorAll('[data-platform]').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.platform === platform);
  });
  renderContent(allContent);
}

function filterTarget(target) {
  currentTarget = target;
  renderContent(allContent);
}

// Scan Content
async function scanContent(event) {
  event.preventDefault();
  const container = document.getElementById('contentContainer');
  container.innerHTML = `
    <div class="loading">
      <div class="spinner"></div>
      <p>Scanning for new content...</p>
    </div>
  `;
  
  try {
    const response = await fetch(`${API_BASE}/scan`, { method: 'POST' });
    if (!response.ok) throw new Error('Scan failed');
    const result = await response.json();
    alert(`Scan complete! Found ${result.newContent || 0} new items.`);
    await refreshData();
  } catch (error) {
    console.error('Scan error:', error);
    alert('Scan failed. Please try again.');
    renderContent(allContent);
  }
}

// Show Coming Soon
function showComingSoon(event) {
  event.preventDefault();
  alert('Coming soon! üöÄ');
}

// Helpers
function formatTime(timestamp) {
  if (!timestamp) return 'Unknown';
  const date = new Date(timestamp);
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / 60000);
  
  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins}m ago`;
  const diffHours = Math.floor(diffMins / 60);
  if (diffHours < 24) return `${diffHours}h ago`;
  const diffDays = Math.floor(diffHours / 24);
  return `${diffDays}d ago`;
}

function formatNumber(num) {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
}

async function refreshData() {
  allContent = await fetchContent();
  const stats = await fetchStats();
  renderContent(allContent);
  updateStats(stats);
}

// Initial Load
(async function init() {
  await refreshData();
  
  // Auto-refresh every 2 minutes
  setInterval(refreshData, 120000);
})();
</script>

</body>
</html>
